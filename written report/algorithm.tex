\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\usepackage{amsmath}
\usepackage[]{algorithm2e}

\makeatletter
\def\BState{\State\hskip-\ALG@thistlm}
\makeatother
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}
%\SweaveOpts{concordance=TRUE}

\begin{algorithm}[H]
 \SetKwInOut{Input}{Log Joint Density}
 \KwResult{Mean Field Approximation}
 Initialise $\lambda$ randomly\;
 \While{Not converged}{
  \For{$i =  1$ \KwTo $7$}{
      Hold $\lambda_{j \neq i}$ fixed\;
      Maximise $\lambda_{i}$ \;
     }
 }
 \caption{Mean Field Variational Bayes}
\end{algorithm}

\begin{eqnarray}
\nabla_{\lambda} L(\theta, \lambda) & = & E_{q} \left[ \nabla_{\lambda}[q_{\theta}(\log(p(\theta, y)) - \log(q(\theta)))] \right] \\
& = & E_{q} \left[ \nabla_{\lambda}[\log(q_{\theta})](\log(p(\theta, y)) - \log(q(\theta))) \right] \nonumber \\
& \approx & 1/S \sum_{s=1}^{S} \nabla_{\lambda}[\log(q_{\theta^s})](\log(p(\theta^s, y)) - \log(q(\theta^s))) \nonumber
\end{eqnarray}

\begin{algorithm}[H]
 \SetKwInOut{Input}{Log Joint Density, Approximation family q}
 \KwResult{Variational Approximation}
 Initialise $\lambda$ to Methods of Moments Estimator\;
 \While{Not converged}{
  Simulate $\theta_s$ for $s = 1, \dots S$ from $q(\theta^{t-1})$
  \For{$i =  1$ \KwTo $7$}{
      Hold $\lambda_{j \neq i}$ fixed\;
      Calculate $\nabla_{\lambda_i}^{t} =  1/S\sum_{s=1}^{S} \nabla_{\lambda}[\log(q_{\theta^s})](\log(p(\theta^s, y)) - \log(q(\theta^s)))$
     }
  Set $\lambda^{t} = \lambda^{t-1} + p_t \nabla_{\lambda}^{t}$
  Set $t = t + 1$
 }
 \caption{Stochastic Gradient Ascent Algorithm 1}
\end{algorithm}

We can use $(\theta_1, \theta_2)' = \mu + L (\epsilon_1, \epsilon_2)'$ and $\theta_3 = Q^{-1}(\epsilon_3 | \alpha, \beta)$ where $(\epsilon_1, \epsilon_2) \sim N(0, I)$ and $\epsilon_3 \sim U(0, 1)$


\begin{algorithm}[H]
 \SetKwInOut{Input}{Log Joint Density, Approximation family q}
 \KwResult{Variational Approximation}
 Initialise $\lambda$ to Methods of Moments Estimator\;
 \While{Not converged}{
  Simulate $\epsilon$ for $s = 1, \dots S$ from $N(0, I)$ and $U(0, 1)$
  Transform $\theta^s = f(\epsilon^s, \lambda^{t-1})$
  \For{$i =  1$ \KwTo $7$}{
      Hold $\lambda_{j \neq i}$ fixed\;
      Calculate $\nabla_{\lambda_i}^{t} =  1/S\sum_{s=1}^{S} \nabla_{\lambda}[(\log(p(\theta^s, y)) - \log(q(\theta^s)))]$
     }
  Set $\lambda^{t} = \lambda^{t-1} + p_t \nabla_{\lambda}^{t}$
  Set $t = t + 1$
 }
 \caption{Stochastic Gradient Ascent Algorithm 2}
\end{algorithm}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(knitr)}
\hlkwd{library}\hlstd{(mvtnorm)}
\hlkwd{library}\hlstd{(reshape)}
\hlstd{summary} \hlkwb{=} \hlkwd{matrix}\hlstd{(} \hlkwd{c}\hlstd{(}\hlnum{0.37}\hlstd{,} \hlopt{-}\hlnum{0.30}\hlstd{,} \hlnum{0.10}\hlstd{,} \hlopt{-}\hlnum{0.03}\hlstd{,} \hlnum{0.10}\hlstd{,} \hlnum{49.2}\hlstd{,} \hlnum{78.4}\hlstd{,} \hlopt{-}\hlnum{77.5}\hlstd{,} \hlnum{7.4}\hlstd{,}
                    \hlnum{0.37}\hlstd{,} \hlopt{-}\hlnum{0.29}\hlstd{,} \hlnum{0.09}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0.10}\hlstd{,} \hlnum{49.5}\hlstd{,} \hlnum{79.8}\hlstd{,} \hlopt{-}\hlnum{77.4}\hlstd{,} \hlstr{"1.3 x 10^\{-6\}"}\hlstd{,}
                    \hlnum{0.32}\hlstd{,} \hlopt{-}\hlnum{0.32}\hlstd{,} \hlnum{0.11}\hlstd{,} \hlopt{-}\hlnum{0.01}\hlstd{,} \hlnum{0.12}\hlstd{,} \hlnum{46.4}\hlstd{,} \hlnum{78.7}\hlstd{,} \hlopt{-}\hlnum{77.2}\hlstd{,} \hlnum{59.5}\hlstd{,}
                    \hlnum{0.38}\hlstd{,} \hlopt{-}\hlnum{0.30}\hlstd{,} \hlopt{-}\hlnum{0.1}\hlstd{,} \hlnum{0.03}\hlstd{,} \hlopt{-}\hlnum{0.10}\hlstd{,} \hlnum{48.7}\hlstd{,} \hlnum{78.9}\hlstd{,} \hlopt{-}\hlnum{77.4}\hlstd{,} \hlnum{1.2}\hlstd{) ,} \hlkwc{byrow} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{ncol} \hlstd{=} \hlnum{9}\hlstd{)}

\hlkwd{colnames}\hlstd{(summary)} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlkwd{paste0}\hlstd{(}\hlkwd{expression}\hlstd{(mu),} \hlnum{1}\hlstd{),} \hlkwd{paste0}\hlstd{(}\hlkwd{expression}\hlstd{(mu),} \hlnum{2}\hlstd{),} \hlstr{"L11"}\hlstd{,} \hlstr{"L21"}\hlstd{,} \hlstr{"L22"}\hlstd{,} \hlkwd{expression}\hlstd{(alpha),} \hlkwd{expression}\hlstd{(beta),} \hlstr{"L(theta)"}\hlstd{,} \hlstr{"time (seconds)*"}\hlstd{)}
\hlkwd{rownames}\hlstd{(summary)} \hlkwb{=} \hlkwd{c}\hlstd{(}\hlstr{"Method of Moments"}\hlstd{,} \hlstr{"Mean Field"}\hlstd{,} \hlstr{"Copula 1"}\hlstd{,} \hlstr{"Copula 2"}\hlstd{)}
\hlkwd{kable}\hlstd{(summary,} \hlkwc{format} \hlstd{=} \hlstr{"latex"}\hlstd{)}
\end{alltt}
\end{kframe}
\begin{tabular}{l|l|l|l|l|l|l|l|l|l}
\hline
  & mu1 & mu2 & L11 & L21 & L22 & alpha & beta & L(theta) & time (seconds)*\\
\hline
Method of Moments & 0.37 & -0.3 & 0.1 & -0.03 & 0.1 & 49.2 & 78.4 & -77.5 & 7.4\\
\hline
Mean Field & 0.37 & -0.29 & 0.09 & 0 & 0.1 & 49.5 & 79.8 & -77.4 & 1.3 x 10\textasciicircum{}\{-6\}\\
\hline
Copula 1 & 0.32 & -0.32 & 0.11 & -0.01 & 0.12 & 46.4 & 78.7 & -77.2 & 59.5\\
\hline
Copula 2 & 0.38 & -0.3 & -0.1 & 0.03 & -0.1 & 48.7 & 78.9 & -77.4 & 1.2\\
\hline
\end{tabular}


\end{knitrout}

\end{document}
